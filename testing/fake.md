# Fake

值得深思一下，雖然自己在使用 TDD 開發時已經有自己的一套方法，但不見得是足夠的；這份簡報裡提到的例子，加上 91 哥的提醒，都值得參考看看，因為我自己可能就會犯這樣的錯誤。
快速地瀏覽一下這些例子的中心思維：

0. 如果換了一個等義的 method 後怎麼辦？ stub 就測不到了， mock 也管不到。問題在於 stub / mock 沒有一起被更新。 

1. 範例 1 中把不必要的 config 類型綁在一起，結果就需要 stub 來固定會用到的特定參數；其實應該拆開，甚至不需要，然後直接從建構子帶參數進去就好。 
2. 範例 2 中在呼叫方法後，同時也改變了物件的狀態，結果需要 stub 來模擬回傳值。應該讓方法回傳新的狀態，也就是 immutable 的設計方式，這樣就能避開要用 stub 來模擬回傳結果的問題。 
3. 範例 3 中希望明確知道寄信的意圖，而不是關心信真的被寄出去沒，所以引入了一個 interpreter 來呈現出這個意圖，而不是用 mock 來驗證 send 方法是否被呼叫。
(這邊只是解釋大意，沒有加上我自己的想法；所以以上有理解錯誤的話，請不吝指正。)
看完之後，我有自己的想法了，或許你也可以有更不錯的觀點。
https://www.facebook.com/91agile/posts/520940284747261

---

遇到了重構後的程式，雖然單元測試通過了，但實際行為卻不一致而導致了 bug 。幾個感想：

1. 環境只能做單元測試時， mock 要小心用；有些行為是有呼叫順序的，當被 mock 掉後，就可能會造成問題。

2. 不想讓外部得知更深層的相依物件，但又希望在測試時注入 mock 物件，可以透過 DI container 來注入。

