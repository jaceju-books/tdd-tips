# 將一連串的判斷式重構成責任鍊模式

## 說明

有時候我們會需要對一組資料做一連串的判斷，來決定程式應該對它有什麼樣的反應。像是判斷參數組的每個參數是否符合格式，或是購物車內的商品是否符合某個行銷活動等。

基本的判斷式寫法大概會像這樣：

```php
if (條件式一) {
    // $result = 運算式;
} elseif (條件式二) {
    // $result = 運算式;
} elseif (條件式三) {
    // $result = 運算式;
} else {
    // $result = 運算式;
}

if ($result !== false) {
    return $result;
} else {
    // 丟出異常
}
```

另一種變形是在 `if` 區塊中直接返回運算結果或丟出異常，而這樣的 `if` 會有連續好幾個。例如：

```php
if (條件式一) {
    // ... 返回運算結果或丟出異常
} 
if (條件式二) {
    // ... 返回運算結果或丟出異常
} 
if (條件式三) {
    // ... 返回運算結果或丟出異常
}

// 返回運算結果
```

這兩種寫法基本上都是類似的形式，我以 `if...elseif` 來說明。

一連串的 `if...elseif` 有幾個問題：

1. 當條件式或區塊內的運算邏輯複雜時，整個判斷式就會非常冗長。
2. 無法從抽象的角度一眼看出這個判斷式主要是要判斷哪些狀況，不容易維護。
3. 有些變數會被重複使用，增加了出現 bug 的風險。

## 範例

這裡有個簡化過的購物車範例，它在計算總金額時，會判斷商品是否需要折價：

```php
class Cart
{
    // ... (略) ...

    public function calculate()
    {
        // A * 0.8, B * 0.1, C - 10
        foreach ($this->_items as $sn => list($price, $quantity)) {
            $type = $sn[0];
            if ($type === 'B') {
                $price *= 0.1;
            } elseif ($type === 'A') {
                $price *= 0.8;
            } elseif ($type === 'C') {
                $price -= 10;
            }
            $this->_total += $price * $quantity;
        }
    }

    // ... (略) ...
}
```

## 重構

